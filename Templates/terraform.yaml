apiVersion: scaffolder.backstage.io/v1beta3
kind: Template
metadata:
  name: avkTerraformTest
  title: Terraform integration
  description: Test integration with terraform
  tags:
    - terraform
    - deployment
    - provisioning
spec:
  owner: avk@sitecore.net
  type: component
  parameters:
    - title: Component configuration
      required:
#        - workspace_name
#        - organization_name
#        - execution_mode
#        - working_directory
#        - identifier
#        - branch
#        - oauth_token_id
#        - environment
#        - component
#        - branch
      properties:
        workspace_name:
          title: Name
          type: string
          description: Unique name of the workspace
          ui:field: EntityNamePicker
        organization_name:
          title: Organization name
          type: string
          description: Name of the organization
    - title: Component information1
      required:
      properties:
        execution_mode:
          title: Execution Mode
          type: string
          description: Execution Mode
        auto_apply:
          title: Auto apply deployment
          description: Auto apply deployment
          type: boolean
          default: false
    - title: Component information2
      required:
      properties:
        speculative_enabled:
          title: Speculative Enabled
          description: Speculative Enabled
          type: boolean
          default: true
        working_directory:
          title: Working Directory
          type: string
          description: Working Directory
        identifier:
          title: Identifier
          type: string
          description: identifier
        branch:
          title: Branch
          type: string
          description: Branch
          ui:field: EntityNamePicker
    - title: Component information3
      required:
      properties:
        ingress_submodules:
          title: Ingress Submodules
          description: Ingress Submodules
          type: boolean
          default: false
        oauth_token_id:
          title: Oauth Token Id
          type: string
          description: Oauth Token Id
          ui:field: EntityNamePicker
        environment:
          title: Environment
          type: string
          description: Environment
          ui:field: EntityNamePicker
        component:
          title: Component
          type: string
          description: Component
          ui:field: EntityNamePicker
    - title: Choose a location
      required:
#        - repoUrl
      properties:
#        repoUrl:
#          title: Repository Location
#          type: string
#          ui:field: RepoUrlPicker
#          ui:options:
#            allowedHosts:
#              - github.com
#        branchName:
#          title: Name of the branch
#          type: string
#          ui:field: EntityNamePicker
#        prTitle:
#          title: Title of PR
#          type: string
#          ui:field: EntityNamePicker
  steps:
#    - id: template
#      name: Fetch Skeleton + Template
#      action: fetch:template
#      input:
#        url: https://github.com/alexv80/RepoForImport
#        copyWithoutRender:
#          - .github/workflows/*
#        values:
#          component_id: ${{ parameters.component_id }}
#          description: ${{ parameters.description }}
#          destination: ${{ parameters.repoUrl | parseRepoUrl }}
#          owner: ${{ parameters.owner }}

    - id: pullRequest
      name: Create pull request
      action: publish:github:pull-request
      input:
        allowedHosts: ["github.com"]
        description: This is ${{ parameters.workspace_name }}
        repoUrl: ${{ parameters.repoUrl }}
        branchName: ${{ parameters.branchName }}
        title: ${{ parameters.prTitle }}

  output:
    links:
      - title: Repository
        url: ${{ steps.publish.output.remoteUrl }}
      - title: Open in catalog
        icon: catalog
        entityRef: ${{ steps.register.output.entityRef }}
